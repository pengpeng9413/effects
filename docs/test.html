<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>翻页特效</title>
    <style>
      body,
      html {
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial,
          Helvetica Neue, Helvetica;
        font-size: 14px;
        line-height: 1.5;
        margin: 0;
        padding: 0;
        color: #333;
      }
      .container * {
        box-sizing: border-box;
      }
      .container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-flow: row nowrap;
      }
      .main {
        flex: 1;
        border-right: 1px solid #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: auto;
        padding: 20px;
      }
      .main figure {
        background-color: #010101;
      }
      .effects,
      .props {
        width: 240px;
        overflow-x: hidden;
        overflow-y: auto;
        padding-bottom: 20px;
      }
      .props {
        width: 301px;
        border-right: 1px solid #ddd;
      }
      .effects-title,
      .props-title {
        font-size: 20px;
        margin: 0 0 10px 0;
        padding: 10px 20px;
        color: #000;
        position: sticky;
        top: 0;
        width: 100%;
        background-color: #f8f8f8;
        border-bottom: 1px solid #ddd;
      }
      .props-item {
        display: flex;
        align-items: center;
        padding: 0 20px;
      }
      .props-item + .props-item {
        margin-top: 15px;
      }
      .props-item .label {
        width: 100px;
        padding-right: 10px;
        line-height: 34px;
        color: #888;
      }
      .props-item .value {
        flex: 1;
      }
      .props-item .value.has-unit {
        position: relative;
        padding-right: 30px;
      }
      .props-item .value.has-unit::after {
        position: absolute;
        right: 0;
        top: 0;
        line-height: 34px;
      }
      .props-item .value.ms::after {
        content: "ms";
      }
      .props-item .value.px::after {
        content: "px";
      }
      .props-item input,
      .props-item select {
        width: 100%;
        height: 34px;
        border: 1px solid #ccc;
        background-color: #fff;
        padding: 5px 8px;
        line-height: 20px;
      }
      .props-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        position: relative;
        cursor: pointer;
      }
      .props-item button {
        display: block;
        width: 100%;
        height: 40px;
        border: 1px solid #5196f2;
        color: #fff;
        background-color: #5196f2;
        outline: 0;
        cursor: pointer;
      }
      .props-item button:active,
      .props-item button:hover {
        border-color: #257cef;
        background-color: #257cef;
      }
      .effect-group {
        padding: 0 20px;
      }
      .effect-group .effect-group__title {
        font-size: 16px;
        margin: 10px 0;
        padding: 0;
        cursor: pointer;
        font-weight: 700;
        user-select: none;
      }
      .effect-group .effect-group__items {
        margin: 5px 0 0 0;
        padding: 0;
        list-style: none;
        user-select: none;
      }
      .effect-group .effect-item {
        line-height: 20px;
        padding: 5px 15px;
        cursor: pointer;
      }
      .effect-group .effect-item:active,
      .effect-group .effect-item:hover {
        background-color: #f0f0f0;
      }
      .effect-group .effect-item.actived {
        background-color: #f0f0f0;
        color: brown;
        font-weight: 700;
      }
      .uploader {
        width: 100%;
        height: 34px;
        cursor: pointer;
        position: relative;
        margin: 0;
        padding: 0;
        display: block;
      }
      .uploader input[type="file"] {
        opacity: 0;
        position: absolute;
        cursor: pointer;
      }
      .uploader .toggle {
        display: block;
        width: 100%;
        height: 34px;
        border: 1px solid #ddd;
        text-align: center;
        line-height: 20px;
        padding: 6px 10px;
        cursor: pointer;
        position: relative;
        z-index: 1;
      }
      .recovery {
        line-height: 20px;
        color: #257cef;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <article class="container">
      <main class="main">
        <div class="canvas" id="canvas">
          <canvas id="c" width="500" height="500"></canvas>
        </div>
      </main>
      <aside class="props">
        <h2 class="effects-title">属性</h2>
        <div class="props-item">
          <span class="label">特效时长</span>
          <div class="value has-unit ms">
            <input
              type="number"
              min="0"
              max="600000"
              step="10"
              value="2000"
              id="fd-duration"
            />
          </div>
        </div>
        <div class="props-item">
          <span class="label">容器宽度</span>
          <div class="value has-unit px">
            <input
              type="number"
              min="100"
              max="1024"
              step="5"
              value="500"
              id="fd-width"
            />
          </div>
        </div>
        <div class="props-item">
          <span class="label">容器高度</span>
          <div class="value has-unit px">
            <input
              type="number"
              min="100"
              max="1024"
              step="5"
              value="500"
              id="fd-height"
            />
          </div>
        </div>
        <div class="props-item">
          <span class="label">缓动类型</span>
          <div class="value">
            <select id="fd-easing">
              <option value="linear">linear</option>
              <option value="quadraticIn">ease-in</option>
              <option value="quadraticOut">ease-out</option>
              <option value="quadraticInOut">ease-in-out</option>
              <option value="cubicIn">cubic-in</option>
              <option value="cubicOut">cubic-out</option>
              <option value="cubicInOut">cubic-in-out</option>
              <option value="quarticIn">quartic-in</option>
              <option value="quarticOut">quartic-out</option>
              <option value="quarticInOut">quartic-in-out</option>
              <option value="circularIn">circular-in</option>
              <option value="circularOut">circular-out</option>
              <option value="circularInOut">circularin-out</option>
              <option value="elasticIn">elastic-in</option>
              <option value="elasticOut">elastic-out</option>
              <option value="elasticInOut">elastic-in-out</option>
              <option value="bounceIn">bounce-in</option>
              <option value="bounceOut">bounce-out</option>
              <option value="bounceInOut">bounce-in-out</option>
            </select>
          </div>
        </div>
        <div class="props-item">
          <span class="label">选择图片</span>
          <div class="value">
            <label class="uploader"
              ><input type="file" accept="image/*" id="customImage" />
              <span class="toggle" role="button">选择图片</span></label
            >
          </div>
        </div>
        <div class="props-item">
          <span class="label">&nbsp;</span>
          <div class="value">
            <a class="recovery" id="recoveryImage" role="button"
              >恢复默认图片</a
            >
          </div>
        </div>
        <div class="props-item">
          <span class="label">开启轮播</span>
          <div class="value"><input type="checkbox" id="fd-loop" /></div>
        </div>
        <div
          class="props-item"
          id="fd-loop-duration_item"
          style="display: none"
        >
          <span class="label">轮播间隔</span>
          <div class="value has-unit ms">
            <input
              type="number"
              min="5000"
              step="1000"
              value="10000"
              id="fd-loop-duration"
            />
          </div>
        </div>
        <div class="props-item">
          <button type="button" id="play">播放</button>
        </div>
      </aside>
      <aside class="effects" id="effectViewport">
        <h2 class="effects-title">特效</h2>
        <div id="effects-wrap"></div>
      </aside>
    </article>
    <script type="text/javascript">
      var c = document.getElementById("c"), //canvas
        ctx = c.getContext("2d"),
        img = new Image(),
        offset = 0,
        fps = 60,
        speed = 80 / fps; //每帧的速度

      img.src = "test.png";
     

      function draw(ctx) {
        ctx.save();
        //offset < c.width ? (offset + speed) : 0
        //后者不能简单重置为0，由于速度过快offset可能超过canvas的大小
        //故需要计算两者的差值
        offset = offset < c.width ? offset + speed : offset - c.width;
        //通过translate来实现图片的滚动
        ctx.translate(-offset, 0);

        //只需将图片正常地绘制在画面上即可，不需要操作其位置
        ctx.drawImage(img, 0, 0,c.width,c.height);
        ctx.drawImage(img, c.width, 0,c.width,c.height);
        ctx.restore();
      }
      window.onload = function () {
        (function () {
          console.log("sss")
          ctx.clearRect(0, 0, c.width, c.height);
          draw(ctx);
          requestAnimationFrame(arguments.callee, c);
        })();
      };
    </script>
    <script type="text/javascript" src="mo.effects.d9559d0.js"></script>
  </body>
</html>
